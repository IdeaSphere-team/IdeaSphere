{% extends "admin/base.html" %}

{% block title %}版块管理 - IdeaSphere 管理后台{% endblock %}

{% block header_title %}版块管理{% endblock %}

{% block content %}
<!-- 顶部按钮 -->
<div class="header-actions-container">
    <button class="btn btn-primary" data-toggle="modal" data-target="#addSectionModal">
        <i class="fas fa-plus"></i> 创建新版块
    </button>
</div>

<!-- 版块卡片列表 -->
<div class="section-cards">
    {% for section in sections %}
    <div class="section-card fade-in" data-id="{{ section.id }}">
        <div class="section-card-header">
            <div class="section-icon" style="background-color: {{ section.icon_color }}">
                <i class="fas fa-{{ section.icon }}"></i>
            </div>
            <div class="section-header-actions">
                <button class="action-btn edit-section-btn" title="编辑版块" data-id="{{ section.id }}">
                    <i class="fas fa-edit"></i>
                </button>
                {% if section.is_active %}
                <button class="action-btn deactivate-section-btn" title="隐藏版块" data-id="{{ section.id }}">
                    <i class="fas fa-eye-slash"></i>
                </button>
                {% else %}
                <button class="action-btn activate-section-btn" title="显示版块" data-id="{{ section.id }}">
                    <i class="fas fa-eye"></i>
                </button>
                {% endif %}
                <button class="action-btn delete-section-btn" title="删除版块" data-id="{{ section.id }}">
                    <i class="fas fa-trash-alt"></i>
                </button>
            </div>
        </div>
        <div class="section-card-body">
            <h3 class="section-title">{{ section.name }}</h3>
            <p class="section-description">{{ section.description }}</p>
            
            <div class="section-stats">
                <div class="stat-item">
                    <i class="fas fa-file-alt"></i>
                    <span>{{ section.post_count }} 帖子</span>
                </div>
                <div class="stat-item">
                    <i class="fas fa-comments"></i>
                    <span>{{ section.comment_count }} 评论</span>
                </div>
                <div class="stat-item">
                    <i class="fas fa-clock"></i>
                    <span>{{ section.created_at.strftime('%Y-%m-%d') }}</span>
                </div>
            </div>
            
            <div class="section-status">
                <span class="status-badge {% if section.is_active %}status-active{% else %}status-inactive{% endif %}">
                    {% if section.is_active %}可见{% else %}隐藏{% endif %}
                </span>
                <span class="sort-order">排序: {{ section.sort_order }}</span>
            </div>
        </div>
        <div class="section-card-footer">
            <a href="#" class="btn btn-light btn-sm">
                查看详情
            </a>
            <a href="{{ url_for('section_detail', section_id=section.id) }}" class="btn btn-light btn-sm" target="_blank">
                <i class="fas fa-external-link-alt"></i> 前台查看
            </a>
        </div>
    </div>
    {% else %}
    <div class="no-sections">
        <div class="no-data-icon">
            <i class="fas fa-layer-group"></i>
        </div>
        <h3>暂无版块</h3>
        <p>点击上方"创建新版块"按钮开始创建</p>
    </div>
    {% endfor %}
</div>

<!-- 添加版块模态框 -->
<div class="modal fade" id="addSectionModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title"><i class="fas fa-layer-group"></i> 创建新版块</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="addSectionForm" action="{{ url_for('create_section') }}" method="POST">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    
                    <div class="form-group">
                        <label for="name" class="form-label">版块名称</label>
                        <input type="text" id="name" name="name" class="form-control" required placeholder="输入版块名称...">
                    </div>
                    
                    <div class="form-group">
                        <label for="description" class="form-label">描述</label>
                        <textarea id="description" name="description" class="form-control" rows="3" required placeholder="描述版块的主题和用途..."></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <label for="icon" class="form-label">图标</label>
                            <div class="icon-selector">
                                <div class="selected-icon" id="selectedIcon">
                                    <i class="fas fa-layer-group"></i>
                                </div>
                                <input type="hidden" id="icon" name="icon" value="layer-group">
                                <button type="button" class="btn btn-light" id="selectIconBtn">
                                    <i class="fas fa-chevron-down"></i>
                                </button>
                            </div>
                            <div class="icon-popup" id="iconPopup">
                                <div class="icon-search">
                                    <input type="text" placeholder="搜索图标..." id="iconSearchInput">
                                </div>
                                <div class="icon-grid">
                                    <div class="icon-item" data-icon="layer-group">
                                        <i class="fas fa-layer-group"></i>
                                    </div>
                                    <div class="icon-item" data-icon="comments">
                                        <i class="fas fa-comments"></i>
                                    </div>
                                    <div class="icon-item" data-icon="code">
                                        <i class="fas fa-code"></i>
                                    </div>
                                    <div class="icon-item" data-icon="book">
                                        <i class="fas fa-book"></i>
                                    </div>
                                    <div class="icon-item" data-icon="laptop-code">
                                        <i class="fas fa-laptop-code"></i>
                                    </div>
                                    <div class="icon-item" data-icon="lightbulb">
                                        <i class="fas fa-lightbulb"></i>
                                    </div>
                                    <div class="icon-item" data-icon="users">
                                        <i class="fas fa-users"></i>
                                    </div>
                                    <div class="icon-item" data-icon="graduation-cap">
                                        <i class="fas fa-graduation-cap"></i>
                                    </div>
                                    <div class="icon-item" data-icon="coffee">
                                        <i class="fas fa-coffee"></i>
                                    </div>
                                    <div class="icon-item" data-icon="gamepad">
                                        <i class="fas fa-gamepad"></i>
                                    </div>
                                    <div class="icon-item" data-icon="chart-line">
                                        <i class="fas fa-chart-line"></i>
                                    </div>
                                    <div class="icon-item" data-icon="paint-brush">
                                        <i class="fas fa-paint-brush"></i>
                                    </div>
                                    <div class="icon-item" data-icon="music">
                                        <i class="fas fa-music"></i>
                                    </div>
                                    <div class="icon-item" data-icon="camera">
                                        <i class="fas fa-camera"></i>
                                    </div>
                                    <div class="icon-item" data-icon="film">
                                        <i class="fas fa-film"></i>
                                    </div>
                                    <div class="icon-item" data-icon="globe">
                                        <i class="fas fa-globe"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group col-md-6">
                            <label for="iconColor" class="form-label">颜色</label>
                            <div class="color-selector">
                                <div class="selected-color" id="selectedColor" style="background-color: #5e72e4;"></div>
                                <input type="hidden" id="iconColor" name="icon_color" value="#5e72e4">
                                <div class="color-options">
                                    <div class="color-option" data-color="#5e72e4" style="background-color: #5e72e4;"></div>
                                    <div class="color-option" data-color="#2dce89" style="background-color: #2dce89;"></div>
                                    <div class="color-option" data-color="#fb6340" style="background-color: #fb6340;"></div>
                                    <div class="color-option" data-color="#11cdef" style="background-color: #11cdef;"></div>
                                    <div class="color-option" data-color="#f5365c" style="background-color: #f5365c;"></div>
                                    <div class="color-option" data-color="#8965e0" style="background-color: #8965e0;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="sortOrder" class="form-label">排序顺序</label>
                        <input type="number" id="sortOrder" name="sort_order" class="form-control" value="0" min="0">
                        <div class="form-text">数字越小，排序越靠前</div>
                    </div>
                    
                    <div class="form-group">
                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="isActive" name="is_active" class="custom-checkbox" checked>
                            <label for="isActive"></label>
                            <span class="checkbox-label">版块可见</span>
                        </div>
                        <div class="form-text ml-4">若不勾选，版块将在前台隐藏</div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-light" data-dismiss="modal">
                    <i class="fas fa-times"></i> 取消
                </button>
                <button type="submit" form="addSectionForm" class="btn btn-primary">
                    <i class="fas fa-check"></i> 创建版块
                </button>
            </div>
        </div>
    </div>
</div>

<!-- 编辑版块模态框 -->
<div class="modal fade" id="editSectionModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title"><i class="fas fa-edit"></i> 编辑版块</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="editSectionForm" action="#" method="POST">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <input type="hidden" id="editSectionId" name="section_id">
                    
                    <div class="form-group">
                        <label for="editName" class="form-label">版块名称</label>
                        <input type="text" id="editName" name="name" class="form-control" required placeholder="输入版块名称...">
                    </div>
                    
                    <div class="form-group">
                        <label for="editDescription" class="form-label">描述</label>
                        <textarea id="editDescription" name="description" class="form-control" rows="3" required placeholder="描述版块的主题和用途..."></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <label for="editIcon" class="form-label">图标</label>
                            <div class="icon-selector">
                                <div class="selected-icon" id="editSelectedIcon">
                                    <i class="fas fa-layer-group"></i>
                                </div>
                                <input type="hidden" id="editIcon" name="icon" value="layer-group">
                                <button type="button" class="btn btn-light" id="editSelectIconBtn">
                                    <i class="fas fa-chevron-down"></i>
                                </button>
                            </div>
                            <div class="icon-popup" id="editIconPopup">
                                <div class="icon-search">
                                    <input type="text" placeholder="搜索图标..." id="editIconSearchInput">
                                </div>
                                <div class="icon-grid">
                                    <div class="icon-item" data-icon="layer-group">
                                        <i class="fas fa-layer-group"></i>
                                    </div>
                                    <div class="icon-item" data-icon="comments">
                                        <i class="fas fa-comments"></i>
                                    </div>
                                    <div class="icon-item" data-icon="code">
                                        <i class="fas fa-code"></i>
                                    </div>
                                    <div class="icon-item" data-icon="book">
                                        <i class="fas fa-book"></i>
                                    </div>
                                    <div class="icon-item" data-icon="laptop-code">
                                        <i class="fas fa-laptop-code"></i>
                                    </div>
                                    <div class="icon-item" data-icon="lightbulb">
                                        <i class="fas fa-lightbulb"></i>
                                    </div>
                                    <div class="icon-item" data-icon="users">
                                        <i class="fas fa-users"></i>
                                    </div>
                                    <div class="icon-item" data-icon="graduation-cap">
                                        <i class="fas fa-graduation-cap"></i>
                                    </div>
                                    <div class="icon-item" data-icon="coffee">
                                        <i class="fas fa-coffee"></i>
                                    </div>
                                    <div class="icon-item" data-icon="gamepad">
                                        <i class="fas fa-gamepad"></i>
                                    </div>
                                    <div class="icon-item" data-icon="chart-line">
                                        <i class="fas fa-chart-line"></i>
                                    </div>
                                    <div class="icon-item" data-icon="paint-brush">
                                        <i class="fas fa-paint-brush"></i>
                                    </div>
                                    <div class="icon-item" data-icon="music">
                                        <i class="fas fa-music"></i>
                                    </div>
                                    <div class="icon-item" data-icon="camera">
                                        <i class="fas fa-camera"></i>
                                    </div>
                                    <div class="icon-item" data-icon="film">
                                        <i class="fas fa-film"></i>
                                    </div>
                                    <div class="icon-item" data-icon="globe">
                                        <i class="fas fa-globe"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group col-md-6">
                            <label for="editIconColor" class="form-label">颜色</label>
                            <div class="color-selector">
                                <div class="selected-color" id="editSelectedColor" style="background-color: #5e72e4;"></div>
                                <input type="hidden" id="editIconColor" name="icon_color" value="#5e72e4">
                                <div class="color-options">
                                    <div class="color-option" data-color="#5e72e4" style="background-color: #5e72e4;"></div>
                                    <div class="color-option" data-color="#2dce89" style="background-color: #2dce89;"></div>
                                    <div class="color-option" data-color="#fb6340" style="background-color: #fb6340;"></div>
                                    <div class="color-option" data-color="#11cdef" style="background-color: #11cdef;"></div>
                                    <div class="color-option" data-color="#f5365c" style="background-color: #f5365c;"></div>
                                    <div class="color-option" data-color="#8965e0" style="background-color: #8965e0;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="editSortOrder" class="form-label">排序顺序</label>
                        <input type="number" id="editSortOrder" name="sort_order" class="form-control" value="0" min="0">
                        <div class="form-text">数字越小，排序越靠前</div>
                    </div>
                    
                    <div class="form-group">
                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="editIsActive" name="is_active" class="custom-checkbox" checked>
                            <label for="editIsActive"></label>
                            <span class="checkbox-label">版块可见</span>
                        </div>
                        <div class="form-text ml-4">若不勾选，版块将在前台隐藏</div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-light" data-dismiss="modal">
                    <i class="fas fa-times"></i> 取消
                </button>
                <button type="submit" form="editSectionForm" class="btn btn-primary">
                    <i class="fas fa-check"></i> 保存更改
                </button>
            </div>
        </div>
    </div>
</div>

<style>
    /* 顶部按钮容器 */
    .header-actions-container {
        margin-bottom: 1.5rem;
        display: flex;
        justify-content: flex-end;
    }
    
    .header-actions-container .btn-primary {
        padding: 0.6rem 1.2rem;
        border-radius: var(--border-radius-md);
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        transition: all 0.2s ease;
        background: linear-gradient(135deg, var(--primary) 0%, var(--primary-darker) 100%);
        border: none;
        box-shadow: 0 3px 6px rgba(94, 114, 228, 0.3);
    }
    
    .header-actions-container .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 10px rgba(94, 114, 228, 0.4);
    }
    
    .header-actions-container .btn-primary:active {
        transform: translateY(0);
        box-shadow: 0 2px 5px rgba(94, 114, 228, 0.3);
    }
    
    .header-actions-container .btn-primary i {
        font-size: 0.875rem;
    }
    
    /* 版块卡片网格 */
    .section-cards {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 1.5rem;
        margin-bottom: 1.5rem;
    }
    
    /* 版块卡片 */
    .section-card {
        background: white;
        border-radius: var(--border-radius-lg);
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05), 0 1px 2px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        transition: all 0.3s ease;
        display: flex;
        flex-direction: column;
        position: relative;
    }
    
    .section-card:hover {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        transform: translateY(-2px);
    }
    
    .section-card:hover .section-card-body .section-title,
    .section-card:hover .section-card-body .section-description,
    .section-card:hover .section-card-body .section-stats .stat-item,
    .section-card:hover .section-card-body .section-status .sort-order {
        color: white;
    }
    
    .section-card:hover .section-card-body {
        background: linear-gradient(135deg, var(--primary) 0%, var(--primary-darker) 100%);
    }
    
    .section-card:hover .section-card-footer {
        background-color: rgba(255, 255, 255, 0.1);
        border-top: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .section-card:hover .btn-light {
        background-color: rgba(255, 255, 255, 0.15);
        color: white;
        border: none;
    }
    
    .section-card:hover .btn-light:hover {
        background-color: rgba(255, 255, 255, 0.25);
    }
    
    .section-card-header {
        padding: 1.25rem;
        display: flex;
        align-items: flex-start;
        justify-content: space-between;
    }
    
    .section-icon {
        width: 48px;
        height: 48px;
        border-radius: var(--border-radius-md);
        background-color: var(--primary);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.25rem;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    
    .section-header-actions {
        display: flex;
        gap: 0.5rem;
    }
    
    .section-card-body {
        padding: 0 1.25rem 1.25rem;
        flex: 1;
        transition: all 0.3s ease;
    }
    
    .section-title {
        font-size: 1.125rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
        transition: color 0.3s ease;
    }
    
    .section-description {
        font-size: 0.875rem;
        color: var(--gray-500);
        margin-bottom: 1rem;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        text-overflow: ellipsis;
        transition: color 0.3s ease;
    }
    
    .section-stats {
        display: flex;
        gap: 1rem;
        margin-bottom: 1rem;
    }
    
    .stat-item {
        display: flex;
        align-items: center;
        gap: 0.375rem;
        font-size: 0.75rem;
        color: var(--gray-600);
        transition: color 0.3s ease;
    }
    
    .section-status {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 1rem;
    }
    
    .status-badge {
        display: inline-flex;
        align-items: center;
        padding: 0.25rem 0.5rem;
        font-size: 0.75rem;
        font-weight: 500;
        border-radius: var(--border-radius-full);
    }
    
    .status-active {
        background-color: rgba(45, 206, 137, 0.1);
        color: var(--success);
    }
    
    .status-inactive {
        background-color: rgba(245, 54, 92, 0.1);
        color: var(--danger);
    }
    
    .sort-order {
        font-size: 0.75rem;
        color: var(--gray-500);
        transition: color 0.3s ease;
    }
    
    .section-card-footer {
        padding: 1rem 1.25rem;
        border-top: 1px solid var(--gray-200);
        display: flex;
        justify-content: space-between;
        transition: all 0.3s ease;
    }
    
    /* 操作按钮 */
    .action-btn {
        width: 28px;
        height: 28px;
        border-radius: var(--border-radius-full);
        background: var(--gray-100);
        color: var(--gray-700);
        display: flex;
        align-items: center;
        justify-content: center;
        border: none;
        cursor: pointer;
        transition: all 0.15s ease;
        font-size: 0.75rem;
    }
    
    .action-btn:hover {
        background: var(--gray-200);
        color: var(--gray-900);
    }
    
    .edit-section-btn:hover {
        background: var(--primary);
        color: white;
    }
    
    .deactivate-section-btn:hover, .delete-section-btn:hover {
        background: var(--danger);
        color: white;
    }
    
    .activate-section-btn:hover {
        background: var(--success);
        color: white;
    }
    
    /* 无数据状态 */
    .no-sections {
        grid-column: 1 / -1;
        background: white;
        border-radius: var(--border-radius-lg);
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05), 0 1px 2px rgba(0, 0, 0, 0.1);
        padding: 3rem;
        text-align: center;
    }
    
    .no-data-icon {
        width: 64px;
        height: 64px;
        background: var(--gray-100);
        border-radius: var(--border-radius-full);
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 1.5rem;
        font-size: 1.5rem;
        color: var(--gray-400);
    }
    
    .no-sections h3 {
        font-size: 1.25rem;
        margin-bottom: 0.5rem;
        color: var(--gray-900);
    }
    
    .no-sections p {
        font-size: 0.875rem;
        color: var(--gray-500);
    }
    
    /* 模态框样式改进 */
    .modal-content {
        border: none;
        border-radius: var(--border-radius-lg);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        overflow: hidden;
    }
    
    .modal-header {
        background: linear-gradient(135deg, var(--primary) 0%, var(--primary-darker) 100%);
        color: white;
        border-bottom: none;
        padding: 1.5rem;
    }
    
    .modal-title {
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }
    
    .modal-title i {
        font-size: 1.25rem;
    }
    
    .modal-header .close {
        color: white;
        opacity: 0.8;
        text-shadow: none;
        transition: opacity 0.15s ease;
    }
    
    .modal-header .close:hover {
        opacity: 1;
    }
    
    .modal-body {
        padding: 1.75rem;
    }
    
    .modal-footer {
        border-top: 1px solid var(--gray-200);
        padding: 1.25rem 1.75rem;
    }
    
    .form-group {
        margin-bottom: 1.5rem;
    }
    
    .form-label {
        font-weight: 500;
        margin-bottom: 0.5rem;
        display: block;
        color: var(--gray-700);
    }
    
    .form-control {
        border: 1px solid var(--gray-300);
        border-radius: var(--border-radius-md);
        padding: 0.5rem 0.75rem;
        font-size: 0.875rem;
        transition: all 0.15s ease;
    }
    
    .form-control:focus {
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(94, 114, 228, 0.1);
    }
    
    .form-text {
        font-size: 0.75rem;
        color: var(--gray-500);
        margin-top: 0.375rem;
    }
    
    /* 图标选择器 */
    .icon-selector {
        position: relative;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .selected-icon {
        width: 42px;
        height: 42px;
        border-radius: var(--border-radius-md);
        background: var(--gray-100);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.25rem;
        color: var(--gray-700);
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }
    
    .icon-popup {
        position: absolute;
        top: calc(100% + 5px);
        left: 0;
        width: 250px;
        background: white;
        border-radius: var(--border-radius-md);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        padding: 1rem;
        z-index: 10;
        display: none;
    }
    
    .icon-popup.show {
        display: block;
        animation: fadeIn 0.2s ease;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(-10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    .icon-search {
        margin-bottom: 0.75rem;
        position: relative;
    }
    
    .icon-search input {
        width: 100%;
        padding: 0.5rem 0.75rem 0.5rem 2rem;
        font-size: 0.75rem;
        border: 1px solid var(--gray-300);
        border-radius: var(--border-radius-md);
    }
    
    .icon-search:before {
        content: "\f002";
        font-family: "Font Awesome 5 Free";
        font-weight: 900;
        position: absolute;
        left: 0.75rem;
        top: 50%;
        transform: translateY(-50%);
        color: var(--gray-500);
        font-size: 0.75rem;
    }
    
    .icon-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 0.5rem;
        max-height: 200px;
        overflow-y: auto;
    }
    
    .icon-item {
        width: 36px;
        height: 36px;
        border-radius: var(--border-radius-md);
        background: var(--gray-100);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1rem;
        color: var(--gray-700);
        cursor: pointer;
        transition: all 0.15s ease;
    }
    
    .icon-item:hover {
        background: var(--primary);
        color: white;
        transform: scale(1.05);
    }
    
    .icon-item.selected {
        background: var(--primary);
        color: white;
        box-shadow: 0 2px 5px rgba(94, 114, 228, 0.3);
    }
    
    /* 颜色选择器 */
    .color-selector {
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }
    
    .selected-color {
        width: 42px;
        height: 42px;
        border-radius: var(--border-radius-md);
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }
    
    .color-options {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
    }
    
    .color-option {
        width: 26px;
        height: 26px;
        border-radius: var(--border-radius-full);
        cursor: pointer;
        transition: all 0.15s ease;
        border: 2px solid transparent;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }
    
    .color-option:hover {
        transform: scale(1.1);
    }
    
    .color-option.selected {
        border-color: var(--gray-900);
        box-shadow: 0 0 0 2px white, 0 0 0 4px var(--gray-300);
    }
    
    /* 表单布局 */
    .form-row {
        display: flex;
        margin: 0 -0.75rem;
    }
    
    .col-md-6 {
        padding: 0 0.75rem;
        width: 50%;
    }
    
    /* 复选框样式 */
    .checkbox-wrapper {
        display: flex;
        align-items: center;
    }
    
    .custom-checkbox {
        position: absolute;
        opacity: 0;
        cursor: pointer;
        height: 0;
        width: 0;
    }
    
    .checkbox-wrapper label {
        position: relative;
        display: inline-block;
        width: 20px;
        height: 20px;
        background-color: var(--gray-200);
        border-radius: var(--border-radius-sm);
        cursor: pointer;
        transition: all 0.15s ease;
        margin-right: 0.5rem;
    }
    
    .custom-checkbox:checked + label {
        background-color: var(--primary);
    }
    
    .checkbox-wrapper label:after {
        content: "";
        position: absolute;
        display: none;
        left: 7px;
        top: 3px;
        width: 6px;
        height: 11px;
        border: solid white;
        border-width: 0 2px 2px 0;
        transform: rotate(45deg);
    }
    
    .custom-checkbox:checked + label:after {
        display: block;
    }
    
    .checkbox-label {
        font-size: 0.875rem;
        margin-top: 1px;
    }
    
    /* 按钮样式 */
    .btn-sm {
        padding: 0.375rem 0.75rem;
        font-size: 0.75rem;
    }
    
    .btn-primary {
        background: linear-gradient(135deg, var(--primary) 0%, var(--primary-darker) 100%);
        border: none;
        box-shadow: 0 2px 5px rgba(94, 114, 228, 0.3);
        transition: all 0.15s ease;
    }
    
    .btn-primary:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(94, 114, 228, 0.4);
    }
    
    /* 响应式布局 */
    @media (max-width: 768px) {
        .section-cards {
            grid-template-columns: 1fr;
        }
        
        .form-row {
            flex-direction: column;
        }
        
        .col-md-6 {
            width: 100%;
            margin-bottom: 1rem;
        }
    }
    
    /* 模态框动画 */
    .modal-content {
        transform: translateY(-20px);
        opacity: 0;
        transition: all 0.3s ease;
    }
    
    .modal-dialog-centered {
        display: flex;
        align-items: center;
        min-height: calc(100% - 3.5rem);
    }
    
    /* 警告框样式 */
    .alert {
        padding: 0.75rem 1rem;
        margin-bottom: 1rem;
        border-radius: var(--border-radius-md);
        display: flex;
        align-items: center;
        gap: 0.75rem;
        font-size: 0.875rem;
    }
    
    .alert-danger {
        background-color: rgba(245, 54, 92, 0.1);
        color: var(--danger);
    }
    
    .alert i {
        font-size: 1rem;
    }
    
    /* 添加左边距样式 */
    .ml-4 {
        margin-left: 1.5rem;
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // 图标选择器功能 - 创建版块
        const selectIconBtn = document.getElementById('selectIconBtn');
        const iconPopup = document.getElementById('iconPopup');
        const selectedIcon = document.getElementById('selectedIcon');
        const iconInput = document.getElementById('icon');
        const iconItems = document.querySelectorAll('#iconPopup .icon-item');
        const iconSearchInput = document.getElementById('iconSearchInput');
        
        // 显示/隐藏图标选择弹窗
        selectIconBtn.addEventListener('click', function(e) {
            e.preventDefault();
            iconPopup.classList.toggle('show');
        });
        
        // 点击外部区域关闭弹窗
        document.addEventListener('click', function(event) {
            if (!iconPopup.contains(event.target) && event.target !== selectIconBtn) {
                iconPopup.classList.remove('show');
            }
        });
        
        // 选择图标
        iconItems.forEach(item => {
            item.addEventListener('click', function() {
                const icon = this.dataset.icon;
                iconInput.value = icon;
                selectedIcon.innerHTML = `<i class="fas fa-${icon}"></i>`;
                iconPopup.classList.remove('show');
                
                // 更新选中状态
                iconItems.forEach(i => i.classList.remove('selected'));
                this.classList.add('selected');
            });
        });
        
        // 搜索图标
        iconSearchInput.addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            
            iconItems.forEach(item => {
                const icon = item.dataset.icon;
                
                if (icon.includes(searchTerm)) {
                    item.style.display = '';
                } else {
                    item.style.display = 'none';
                }
            });
        });
        
        // 初始化选中状态
        iconItems.forEach(item => {
            if (item.dataset.icon === iconInput.value) {
                item.classList.add('selected');
            }
        });
        
        // 颜色选择器功能 - 创建版块
        const colorOptions = document.querySelectorAll('.color-option');
        const selectedColor = document.getElementById('selectedColor');
        const colorInput = document.getElementById('iconColor');
        
        colorOptions.forEach(option => {
            option.addEventListener('click', function() {
                const color = this.dataset.color;
                colorInput.value = color;
                selectedColor.style.backgroundColor = color;
                
                // 更新选中状态
                colorOptions.forEach(o => o.classList.remove('selected'));
                this.classList.add('selected');
            });
            
            // 初始化选中状态
            if (option.dataset.color === colorInput.value) {
                option.classList.add('selected');
            }
        });
        
        // 图标选择器功能 - 编辑版块
        const editSelectIconBtn = document.getElementById('editSelectIconBtn');
        const editIconPopup = document.getElementById('editIconPopup');
        const editSelectedIcon = document.getElementById('editSelectedIcon');
        const editIconInput = document.getElementById('editIcon');
        const editIconItems = document.querySelectorAll('#editIconPopup .icon-item');
        const editIconSearchInput = document.getElementById('editIconSearchInput');
        
        // 显示/隐藏图标选择弹窗
        if (editSelectIconBtn) {
            editSelectIconBtn.addEventListener('click', function(e) {
                e.preventDefault();
                editIconPopup.classList.toggle('show');
            });
            
            // 点击外部区域关闭弹窗
            document.addEventListener('click', function(event) {
                if (!editIconPopup.contains(event.target) && event.target !== editSelectIconBtn) {
                    editIconPopup.classList.remove('show');
                }
            });
            
            // 选择图标
            editIconItems.forEach(item => {
                item.addEventListener('click', function() {
                    const icon = this.dataset.icon;
                    editIconInput.value = icon;
                    editSelectedIcon.innerHTML = `<i class="fas fa-${icon}"></i>`;
                    editIconPopup.classList.remove('show');
                    
                    // 更新选中状态
                    editIconItems.forEach(i => i.classList.remove('selected'));
                    this.classList.add('selected');
                });
            });
            
            // 搜索图标
            editIconSearchInput.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                
                editIconItems.forEach(item => {
                    const icon = item.dataset.icon;
                    
                    if (icon.includes(searchTerm)) {
                        item.style.display = '';
                    } else {
                        item.style.display = 'none';
                    }
                });
            });
        }
        
        // 版块操作按钮
        const editBtns = document.querySelectorAll('.edit-section-btn');
        const deactivateBtns = document.querySelectorAll('.deactivate-section-btn');
        const activateBtns = document.querySelectorAll('.activate-section-btn');
        const deleteBtns = document.querySelectorAll('.delete-section-btn');
        
        // 编辑版块
        editBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                const sectionId = this.dataset.id;
                console.log('Editing section:', sectionId);
                
                // 这里应该加载版块数据并打开编辑模态框
                // 实际项目中应该发送AJAX请求获取数据
                
                // 示例：
                document.getElementById('editSectionId').value = sectionId;
                document.getElementById('editName').value = '版块名称'; // 实际应该是从服务器获取的数据
                document.getElementById('editDescription').value = '版块描述';
                document.getElementById('editIcon').value = 'layer-group';
                document.getElementById('editSelectedIcon').innerHTML = '<i class="fas fa-layer-group"></i>';
                document.getElementById('editIconColor').value = '#5e72e4';
                document.getElementById('editSelectedColor').style.backgroundColor = '#5e72e4';
                document.getElementById('editSortOrder').value = '0';
                document.getElementById('editIsActive').checked = true;
                
                // 打开模态框
                $('#editSectionModal').modal('show');
            });
        });
        
        // 禁用版块
        deactivateBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                const sectionId = this.dataset.id;
                
                // 创建确认对话框
                const confirmDialog = document.createElement('div');
                confirmDialog.className = 'modal fade';
                confirmDialog.id = 'confirmDeactivateModal';
                confirmDialog.innerHTML = `
                    <div class="modal-dialog modal-dialog-centered" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h4 class="modal-title"><i class="fas fa-eye-slash"></i> 隐藏版块</h4>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="modal-body">
                                <p>确定要隐藏此版块吗？隐藏后，用户将无法在前台看到此版块。</p>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-light" data-dismiss="modal">取消</button>
                                <button type="button" class="btn btn-danger" id="confirmDeactivateBtn">
                                    <i class="fas fa-eye-slash"></i> 确认隐藏
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(confirmDialog);
                
                // 显示对话框
                $('#confirmDeactivateModal').modal('show');
                
                // 确认禁用
                document.getElementById('confirmDeactivateBtn').addEventListener('click', function() {
                    console.log('Deactivating section:', sectionId);
                    // 这里应该发送AJAX请求
                    // 实际项目中，请求成功后应该刷新页面或更新UI
                    
                    // 关闭对话框
                    $('#confirmDeactivateModal').modal('hide');
                    
                    // 移除对话框
                    setTimeout(function() {
                        document.body.removeChild(confirmDialog);
                    }, 500);
                });
                
                // 对话框关闭后移除
                $('#confirmDeactivateModal').on('hidden.bs.modal', function() {
                    setTimeout(function() {
                        if (document.body.contains(confirmDialog)) {
                            document.body.removeChild(confirmDialog);
                        }
                    }, 500);
                });
            });
        });
        
        // 启用版块
        activateBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                const sectionId = this.dataset.id;
                
                // 创建确认对话框
                const confirmDialog = document.createElement('div');
                confirmDialog.className = 'modal fade';
                confirmDialog.id = 'confirmActivateModal';
                confirmDialog.innerHTML = `
                    <div class="modal-dialog modal-dialog-centered" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h4 class="modal-title"><i class="fas fa-eye"></i> 显示版块</h4>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="modal-body">
                                <p>确定要显示此版块吗？显示后，用户将可以在前台看到此版块。</p>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-light" data-dismiss="modal">取消</button>
                                <button type="button" class="btn btn-success" id="confirmActivateBtn">
                                    <i class="fas fa-eye"></i> 确认显示
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(confirmDialog);
                
                // 显示对话框
                $('#confirmActivateModal').modal('show');
                
                // 确认启用
                document.getElementById('confirmActivateBtn').addEventListener('click', function() {
                    console.log('Activating section:', sectionId);
                    // 这里应该发送AJAX请求
                    // 实际项目中，请求成功后应该刷新页面或更新UI
                    
                    // 关闭对话框
                    $('#confirmActivateModal').modal('hide');
                    
                    // 移除对话框
                    setTimeout(function() {
                        document.body.removeChild(confirmDialog);
                    }, 500);
                });
                
                // 对话框关闭后移除
                $('#confirmActivateModal').on('hidden.bs.modal', function() {
                    setTimeout(function() {
                        if (document.body.contains(confirmDialog)) {
                            document.body.removeChild(confirmDialog);
                        }
                    }, 500);
                });
            });
        });
        
        // 删除版块
        deleteBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                const sectionId = this.dataset.id;
                
                // 创建确认对话框
                const confirmDialog = document.createElement('div');
                confirmDialog.className = 'modal fade';
                confirmDialog.id = 'confirmDeleteModal';
                confirmDialog.innerHTML = `
                    <div class="modal-dialog modal-dialog-centered" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h4 class="modal-title"><i class="fas fa-trash-alt"></i> 删除版块</h4>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="modal-body">
                                <div class="alert alert-danger" role="alert">
                                    <i class="fas fa-exclamation-triangle"></i> 警告：此操作不可恢复！
                                </div>
                                <p>确定要删除此版块吗？删除后，该版块下的所有帖子和评论也将被删除。</p>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-light" data-dismiss="modal">取消</button>
                                <button type="button" class="btn btn-danger" id="confirmDeleteBtn">
                                    <i class="fas fa-trash-alt"></i> 确认删除
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(confirmDialog);
                
                // 显示对话框
                $('#confirmDeleteModal').modal('show');
                
                // 确认删除
                document.getElementById('confirmDeleteBtn').addEventListener('click', function() {
                    console.log('Deleting section:', sectionId);
                    // 这里应该发送AJAX请求
                    // 实际项目中，请求成功后应该刷新页面或更新UI
                    
                    // 关闭对话框
                    $('#confirmDeleteModal').modal('hide');
                    
                    // 移除对话框
                    setTimeout(function() {
                        document.body.removeChild(confirmDialog);
                    }, 500);
                });
                
                // 对话框关闭后移除
                $('#confirmDeleteModal').on('hidden.bs.modal', function() {
                    setTimeout(function() {
                        if (document.body.contains(confirmDialog)) {
                            document.body.removeChild(confirmDialog);
                        }
                    }, 500);
                });
            });
        });
        
        // 添加版块模态框动画效果
        $('#addSectionModal').on('show.bs.modal', function() {
            setTimeout(() => {
                const modalContent = this.querySelector('.modal-content');
                modalContent.style.transform = 'translateY(0)';
                modalContent.style.opacity = '1';
            }, 50);
        });
        
        $('#addSectionModal').on('hide.bs.modal', function() {
            const modalContent = this.querySelector('.modal-content');
            modalContent.style.transform = 'translateY(-20px)';
            modalContent.style.opacity = '0';
        });
        
        // 编辑版块模态框动画效果
        $('#editSectionModal').on('show.bs.modal', function() {
            setTimeout(() => {
                const modalContent = this.querySelector('.modal-content');
                modalContent.style.transform = 'translateY(0)';
                modalContent.style.opacity = '1';
            }, 50);
        });
        
        $('#editSectionModal').on('hide.bs.modal', function() {
            const modalContent = this.querySelector('.modal-content');
            modalContent.style.transform = 'translateY(-20px)';
            modalContent.style.opacity = '0';
        });
        
        // 处理编辑表单提交
        const editForm = document.getElementById('editSectionForm');
        if (editForm) {
            editForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const sectionId = document.getElementById('editSectionId').value;
                // 设置正确的action URL
                this.action = '{{ url_for("edit_section", section_id=0) }}'.replace('0', sectionId);
                this.submit();
            });
        }
        
        // 处理板块表单提交
        const addSectionForm = document.getElementById('addSectionForm');
        if (addSectionForm) {
            addSectionForm.addEventListener('submit', function(e) {
                e.preventDefault();
                this.action = '{{ url_for("create_section") }}';
                this.submit();
            });
        }
    });
</script>
{% endblock %} 